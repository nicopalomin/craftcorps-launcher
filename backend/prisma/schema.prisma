generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AnalyticsUser {
  id        String   @id // UUID from client
  createdAt DateTime @default(now())
  lastSeen  DateTime @updatedAt
  country   String?  // [NEW] ISO Country Code (e.g. "US")
  hardware  Hardware?
  events    Event[]
  sessions  Session[]
  crashes   CrashReport[]
}

model Session {
  id        Int      @id @default(autoincrement())
  userId    String
  user      AnalyticsUser @relation(fields: [userId], references: [id])
  startTime DateTime @default(now())
  endTime   DateTime @default(now())
  appVersion String? // [NEW] e.g. "0.1.10"
}

model Hardware {
  id        Int    @id @default(autoincrement())
  userId    String @unique
  user      AnalyticsUser @relation(fields: [userId], references: [id])
  os        String // "win32", "darwin"
  osVersion String // "10.0.19045"
  ram       String // "16 GB"
  gpu       String // "NVIDIA GeForce RTX 3060"
  cpu       String // "Intel(R) Core(TM) i7-..."
}

model Event {
  id        Int      @id @default(autoincrement())
  userId    String
  user      AnalyticsUser @relation(fields: [userId], references: [id])
  type      String   // e.g., "APP_OPEN", "GAME_CRASH", "GAME_LAUNCH"
  metadata  String?  // JSON string
  createdAt DateTime @default(now())
}

model CrashReport {
  id          Int      @id @default(autoincrement())
  reportId    String   @unique // guid from Electron
  submissionId String? // Optional internal ID
  date        DateTime @default(now())
  
  // Metadata from Electron
  platform    String?
  processType String?
  appVersion  String?
  
  // User info
  userId      String?
  user        AnalyticsUser? @relation(fields: [userId], references: [id])
  
  // File info
  dumpPath    String // Path to stored minidump
  
  // Raw request info
  ip          String?
  country     String?
}
